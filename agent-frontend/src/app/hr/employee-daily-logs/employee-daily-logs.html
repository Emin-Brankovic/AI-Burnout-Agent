<app-navbar></app-navbar>
<div class="employee-logs-container">
  <div class="header-section">
    <h1>Employee Daily Logs</h1>
    <p>Select an employee to view their daily log history and burnout analysis.</p>
  </div>

  <div class="filter-section">
    <mat-form-field appearance="outline" class="employee-select">
      <mat-label>Select Employee</mat-label>
      <mat-select (selectionChange)="onEmployeeSelect($event)">
        <mat-option *ngFor="let emp of employees()" [value]="emp.id">
          ({{emp.id}})  {{emp.first_name}} {{emp.last_name}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="table-container mat-elevation-z2" *ngIf="selectedEmployeeId">
    <div class="loading-shade" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <table mat-table [dataSource]="dataSource">

      <!-- Date Column -->
      <ng-container matColumnDef="log_date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let element"> {{element.log_date | date:'mediumDate'}} </td>
      </ng-container>

      <!-- Hours Worked Column -->
      <ng-container matColumnDef="hours_worked">
        <th mat-header-cell *matHeaderCellDef> Hours Worked </th>
        <td mat-cell *matCellDef="let element"> {{element.hours_worked}} </td>
      </ng-container>

      <!-- Hours Slept Column -->
      <ng-container matColumnDef="hours_slept">
        <th mat-header-cell *matHeaderCellDef> Hours Slept </th>
        <td mat-cell *matCellDef="let element"> {{element.hours_slept}} </td>
      </ng-container>

      <!-- Stress Level Column -->
      <ng-container matColumnDef="stress_level">
        <th mat-header-cell *matHeaderCellDef> Stress (1-10) </th>
        <td mat-cell *matCellDef="let element">
                    <span [class.high-stress]="element.stress_level >= 7">
                        {{element.stress_level}}
                    </span>
        </td>
      </ng-container>

      <!-- Motivation Level Column -->
      <ng-container matColumnDef="motivation_level">
        <th mat-header-cell *matHeaderCellDef> Motivation (1-10) </th>
        <td mat-cell *matCellDef="let element"> {{element.motivation_level}} </td>
      </ng-container>

      <!-- Burnout Risk Column -->
      <ng-container matColumnDef="burnout_risk">
        <th mat-header-cell *matHeaderCellDef> Burnout Risk </th>
        <td mat-cell *matCellDef="let element">
          <mat-chip-listbox>
            <mat-chip-option [color]="element.burnout_risk === 'HIGH' || element.burnout_risk === 'CRITICAL' ? 'warn' :
                       element.burnout_risk === 'MEDIUM' ? 'accent' : 'primary'" selected>
              {{element.burnout_risk}}
            </mat-chip-option>
          </mat-chip-listbox>
        </td>
      </ng-container>

      <!-- Burnout Rate Column -->
      <ng-container matColumnDef="burnout_rate">
        <th mat-header-cell *matHeaderCellDef> Burnout Rate </th>
        <td mat-cell *matCellDef="let element">
          {{element.burnout_rate | percent:'1.0-1'}}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="7" style="text-align: center; padding: 20px;">
          No logs found for this employee.
        </td>
      </tr>
    </table>

    <mat-paginator [length]="totalLogs" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 100]"
                   (page)="onPageChange($event)" aria-label="Select page of daily logs">
    </mat-paginator>
  </div>

  <div *ngIf="!selectedEmployeeId" class="no-selection-message">
    <mat-icon>person_search</mat-icon>
    <h3>Please select an employee to view their logs</h3>
  </div>
</div>
